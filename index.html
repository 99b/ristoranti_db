<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Gestione Ristoranti</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/99b/ristoranti_db/main/images/7845744.png" sizes="96x96">
  <link rel="stylesheet" type="text/css" href="stile_indice.css" />
</head>
<body>
  <div class="formnew">
    <h2>Inserisci o Modifica un Ristorante</h2>
    
    <form id="formRistorante">
      <label for="nome"><i class="fa-solid fa-shop"></i> Nome</label>
      <input list="nomiRistoranti" id="nome" placeholder="Scrivi o seleziona un nome" required>
      <datalist id="nomiRistoranti"></datalist>

      <label><i class="fa-solid fa-location-dot"></i> Indirizzo</label>
      <input type="text" id="indirizzo" placeholder="Inserisci l'indirizzo (es. Viale Romagna 20, Milano)">

      <label><i class="fa-solid fa-map"></i> Zona</label>
      <input type="text" id="zona" placeholder="Inserisci la zona (es. Piola)">

      <label><i class="fa-solid fa-burger"></i> Cucina</label>
      <input type="text" id="cucina" placeholder="Inserisci la tipologia di cucina">

      <!-- PREZZO - CUSTOM SELECT CON ICONE -->
      <label><i class="fa-solid fa-receipt"></i> Prezzo</label>
      <div class="custom-select" id="customPrezzo">
        <div class="selected">
          <div class="selected-content">
            <i class="fa-solid fa-coins"></i> Seleziona la fascia di prezzo a persona
          </div>
          <i class="fa-solid fa-chevron-down freccia"></i>
        </div>
        <ul class="select-options" id="priceOptions">
          <li data-value=""><i class="fa-solid fa-question"></i> Non Conosciuto</li>
          <li data-value="0 - 10 â‚¬"><i class="fa-solid fa-coins"></i> 0 - 10 â‚¬</li>
          <li data-value="10 - 20 â‚¬"><i class="fa-solid fa-money-bill-1"></i> 10 - 20 â‚¬</li>
          <li data-value="20 - 30 â‚¬"><i class="fa-solid fa-money-bill"></i> 20 - 30 â‚¬</li>
          <li data-value="30 - 40 â‚¬"><i class="fa-solid fa-money-bills"></i> 30 - 40 â‚¬</li>
          <li data-value="+ 40 â‚¬"><i class="fa-solid fa-sack-dollar"></i> + 40 â‚¬</li>
        </ul>
      </div>
      <input type="hidden" id="prezzo" name="prezzo">

      <label><i class="fa-solid fa-ranking-star"></i> Tripadvisor</label>
      <input type="number" id="tripadvisor" min="1" max="5" step="0.01"placeholder="Es. 3.5">

      <label><i class="fa-solid fa-star"></i> Alessandro</label>
      <input type="number" id="votoA" min="1" max="5" step="0.01" placeholder="Inserisci un voto da 1 a 5 (es. 3.5)">

      <label><i class="fa-solid fa-star"></i> Francesca</label>
      <input type="number" id="votoF" min="1" max="5" step="0.01" placeholder="Inserisci un voto da 1 a 5 (es. 3.5)">

      <label><i class="fa-solid fa-star"></i> Giacomo</label>
      <input type="number" id="votoG" min="1" max="5" step="0.01" placeholder="Inserisci un voto da 1 a 5 (es. 3.5)">

      <label><i class="fa-solid fa-star"></i> Lucia</label>
      <input type="number" id="votoL" min="1" max="5" step="0.01" placeholder="Inserisci un voto da 1 a 5 (es. 3.5)">

      <label><i class="fa-solid fa-comments"></i> Note (aggiungi i tuoi commenti)</label>
      <textarea id="note" placeholder="Scrivi eventuali note o commenti..."></textarea>

      <button type="submit">
        <i class="fa-solid fa-floppy-disk"></i> Salva / Aggiorna
      </button>
    </form>

    <p id="msg"></p>
    
    <a href="tabella.html">
      <i class="fa-solid fa-list-ul"></i> Vai alla tabella ristoranti
    </a>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzuyvSKQkkOdyIXdxKIGxtCC7PEnOT9qwbi1CxCJYquPnQfwX-9Brs7tHzH2ccgnSh_gw/exec"; // ðŸ‘ˆ sostituisci

    let ristoranti = [];

    async function caricaDati() {
      const res = await fetch(scriptURL);
      ristoranti = await res.json();
      const datalist = document.getElementById("nomiRistoranti");
      datalist.innerHTML = "";
      ristoranti.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r["Nome"];
        datalist.appendChild(opt);
      });
    }

    document.getElementById("nome").addEventListener("input", e => {
      const nome = e.target.value.trim().toLowerCase();
      const r = ristoranti.find(x => x["Nome"].toLowerCase() === nome);
      if (r) {
        document.getElementById("indirizzo").value = r["Indirizzo"] || "";
        document.getElementById("zona").value = r["Zona"] || "";
        document.getElementById("cucina").value = r["Cucina"] || "";
        document.getElementById("prezzo").value = r["Prezzo"] || "";
        document.getElementById("tripadvisor").value = r["Tripadvisor"] || "";
        document.getElementById("votoA").value = r["Alessandro"] || "";
        document.getElementById("votoF").value = r["Francesca"] || "";
        document.getElementById("votoG").value = r["Giacomo"] || "";
        document.getElementById("votoL").value = r["Lucia"] || "";
        document.getElementById("note").value = r["Note"] || "";
      } else {
        document.querySelectorAll("#formRistorante input, #formRistorante select, #formRistorante textarea")
          .forEach(el => { if (el.id !== "nome") el.value = ""; });
      }
    });

    document.getElementById("formRistorante").addEventListener("submit", async e => {
      e.preventDefault();
      const data = {
        nome: nome.value,
        indirizzo: indirizzo.value,
        zona: zona.value,
        cucina: cucina.value,
        prezzo: prezzo.value,
        tripadvisor: tripadvisor.value,
        votoA: votoA.value,
        votoF: votoF.value,
        votoG: votoG.value,
        votoL: votoL.value,
        note: note.value
      };
      await fetch(scriptURL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
      msg.innerHTML = '<i class="fa-solid fa-check" style="color:#3e4f47;"></i> Dati salvati!';
      setTimeout(() => msg.textContent = "", 2000);
      caricaDati();
    });

    caricaDati();
    // --- Custom select Prezzo ---
    const customSelect = document.getElementById("customPrezzo");
    const selected = customSelect.querySelector(".selected");
    const options = customSelect.querySelector(".select-options");
    const hiddenInput = document.getElementById("prezzo");

    // apri/chiudi menu
    selected.addEventListener("click", () => {
      customSelect.classList.toggle("open");
    });

    // seleziona unâ€™opzione
    options.addEventListener("click", e => {
      const li = e.target.closest("li");
      if (!li) return;
      // aggiorna testo e input hidden
      const selectedContent = selected.querySelector(".selected-content");
      selectedContent.innerHTML = li.innerHTML;
      hiddenInput.value = li.dataset.value;
      
      options.querySelectorAll("li").forEach(el => el.classList.remove("selected"));
      li.classList.add("selected");
      customSelect.classList.remove("open");
    });

    // chiudi cliccando fuori
    document.addEventListener("click", e => {
      if (!customSelect.contains(e.target)) customSelect.classList.remove("open");
    });

  </script>
</body>
</html>